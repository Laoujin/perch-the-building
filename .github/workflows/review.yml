name: AI Code Review

on:
  pull_request:
    types: [opened, synchronize]
    branches: [master]

jobs:
  review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      id-token: write
    steps:
      - uses: actions/checkout@v5
        with:
          fetch-depth: 0

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          track_progress: true
          prompt: |
            REPO: ${{ github.repository }}
            PR NUMBER: ${{ github.event.pull_request.number }}

            Read `.github/review-instructions.md` for the full review criteria and output format.
            Read `CLAUDE.md` for project conventions and architecture rules.

            Review this pull request following those instructions.
            The PR branch is already checked out in the current working directory.

            Use inline comments for specific code issues.
            Use `gh pr comment` for the overall summary and verdict.

          claude_args: |
            --model claude-sonnet-4-5-20250929
            --allowedTools "Read,Glob,Grep,mcp__github_inline_comment__create_inline_comment,Bash(gh pr comment:*),Bash(gh pr diff:*),Bash(gh pr view:*),Bash(git diff:*),Bash(git log:*)"
