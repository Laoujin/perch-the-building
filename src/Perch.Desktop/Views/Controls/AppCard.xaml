<UserControl
    x:Class="Perch.Desktop.Views.Controls.AppCard"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:models="clr-namespace:Perch.Desktop.Models"
    xmlns:controls="clr-namespace:Perch.Desktop.Views.Controls">
    <Border
        x:Name="CardBorder"
        Background="{StaticResource CardBackgroundBrush}"
        BorderThickness="1"
        CornerRadius="8"
        Padding="12"
        Width="280">
        <Border.Style>
            <Style TargetType="Border">
                <Setter Property="BorderBrush" Value="{StaticResource CardBorderBrush}" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsManaged, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True">
                        <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Border.Style>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Row 0: Status ribbon + badges + expand chevron -->
            <Grid Grid.Row="0" Margin="0,0,0,6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <controls:StatusRibbon
                    Grid.Column="0"
                    Status="{Binding Status, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    VerticalAlignment="Center" />

                <!-- Suggested badge -->
                <Border
                    Grid.Column="1"
                    Background="{StaticResource SuggestedBadgeBrush}"
                    CornerRadius="4"
                    Padding="4,1"
                    Margin="4,0,0,0"
                    VerticalAlignment="Center"
                    Visibility="{Binding IsSuggested, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBlock Text="Suggested" FontSize="9" Foreground="{StaticResource SuggestedTextBrush}" />
                </Border>

                <!-- Kind badge -->
                <Border
                    Grid.Column="2"
                    Background="{StaticResource CardBorderBrush}"
                    CornerRadius="4"
                    Padding="4,1"
                    Margin="4,0,0,0"
                    VerticalAlignment="Center"
                    Visibility="{Binding KindBadge, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource NullToVisibilityConverter}}">
                    <TextBlock
                        Text="{Binding KindBadge, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        FontSize="9"
                        Foreground="{StaticResource TextMutedBrush}" />
                </Border>

                <!-- Hot badge -->
                <Border
                    Grid.Column="3"
                    Background="{StaticResource HotBadgeBrush}"
                    CornerRadius="4"
                    Padding="4,1"
                    Margin="4,0,0,0"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Left"
                    Visibility="{Binding IsHot, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBlock Text="Hot" FontSize="9" Foreground="{StaticResource HotTextBrush}" />
                </Border>

                <!-- GitHub stars badge -->
                <Border
                    Grid.Column="4"
                    Background="{StaticResource SurfaceBrush}"
                    CornerRadius="10"
                    Margin="4,0,0,0"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Left"
                    Visibility="{Binding GitHubStarsFormatted, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource NullToVisibilityConverter}}">
                    <Button
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="6,1"
                        Click="OnLinkClick"
                        Tag="{Binding GitHub, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        ToolTip="{Binding GitHub, RelativeSource={RelativeSource AncestorType=UserControl}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#x2605;" FontSize="9" Foreground="{StaticResource WarningBrush}" />
                            <TextBlock
                                Text="{Binding GitHubStarsFormatted, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                FontSize="9"
                                Foreground="White"
                                Margin="3,0,0,0" />
                        </StackPanel>
                    </Button>
                </Border>

                <!-- Expand/collapse chevron -->
                <ui:Button
                    Grid.Column="5"
                    Appearance="Secondary"
                    Padding="2"
                    Margin="4,0"
                    VerticalAlignment="Center"
                    Click="OnConfigureClick"
                    ToolTip="View details"
                    Visibility="{Binding HasDetailPage, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <ui:SymbolIcon
                        Symbol="ChevronDown24"
                        FontSize="14"
                        RenderTransformOrigin="0.5,0.5">
                        <ui:SymbolIcon.Style>
                            <Style TargetType="ui:SymbolIcon">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsExpanded}" Value="True">
                                        <Setter Property="RenderTransform">
                                            <Setter.Value>
                                                <RotateTransform Angle="180" />
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ui:SymbolIcon.Style>
                    </ui:SymbolIcon>
                </ui:Button>
            </Grid>

            <!-- Row 1: Logo + Name -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Grid Grid.Column="0" Width="24" Height="24" VerticalAlignment="Center" Margin="0,0,8,0">
                    <Border
                        x:Name="FallbackIcon"
                        Width="24"
                        Height="24"
                        CornerRadius="12"
                        Background="{StaticResource CardBorderBrush}">
                        <TextBlock
                            x:Name="FallbackInitial"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource TextSubtleBrush}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center" />
                    </Border>
                    <Border CornerRadius="12" Width="24" Height="24">
                        <Border.Clip>
                            <EllipseGeometry Center="12,12" RadiusX="12" RadiusY="12" />
                        </Border.Clip>
                        <Image
                            x:Name="LogoImage"
                            Width="24"
                            Height="24"
                            Stretch="UniformToFill"
                            RenderOptions.BitmapScalingMode="HighQuality" />
                    </Border>
                </Grid>

                <TextBlock
                    Grid.Column="1"
                    Text="{Binding DisplayLabel, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    FontSize="13"
                    FontWeight="SemiBold"
                    Foreground="White"
                    VerticalAlignment="Center"
                    TextTrimming="CharacterEllipsis" />
            </Grid>

            <!-- Row 2: Description (2-line max) -->
            <TextBlock
                Grid.Row="2"
                Text="{Binding Description, RelativeSource={RelativeSource AncestorType=UserControl}}"
                FontSize="11"
                Foreground="{StaticResource TextMutedBrush}"
                TextWrapping="Wrap"
                TextTrimming="CharacterEllipsis"
                MaxHeight="32"
                Margin="0,4,0,0"
                Visibility="{Binding Description, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource NullToVisibilityConverter}}" />

            <!-- Row 3: Links bar -->
            <StackPanel
                Grid.Row="3"
                Orientation="Horizontal"
                Margin="0,6,0,0">
                <Button Background="Transparent" BorderThickness="0" Padding="4,2" Margin="0,0,4,0"
                    Click="OnLinkClick"
                    Tag="{Binding Website, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    ToolTip="{Binding Website, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Visibility="{Binding Website, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource NullToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="Globe24" FontSize="12" Foreground="{StaticResource LinkTextBrush}" />
                        <TextBlock Text="Website" FontSize="10" Foreground="{StaticResource LinkTextBrush}" Margin="4,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>
                <Button Background="Transparent" BorderThickness="0" Padding="4,2" Margin="0,0,4,0"
                    Click="OnLinkClick"
                    Tag="{Binding Docs, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    ToolTip="{Binding Docs, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Visibility="{Binding Docs, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource NullToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="Document24" FontSize="12" Foreground="{StaticResource LinkTextBrush}" />
                        <TextBlock Text="Docs" FontSize="10" Foreground="{StaticResource LinkTextBrush}" Margin="4,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>
                <Button Background="Transparent" BorderThickness="0" Padding="4,2"
                    Click="OnLinkClick"
                    Tag="{Binding GitHub, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    ToolTip="{Binding GitHub, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Visibility="{Binding GitHub, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource NullToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="Code24" FontSize="12" Foreground="{StaticResource LinkTextBrush}" />
                        <TextBlock Text="GitHub" FontSize="10" Foreground="{StaticResource LinkTextBrush}" Margin="4,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>
                <Button Background="Transparent" BorderThickness="0" Padding="4,2"
                    Click="OnOpenLocationClick"
                    Tag="{Binding ConfigPath, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    ToolTip="{Binding ConfigPath, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Visibility="{Binding ConfigPath, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource NullToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="FolderOpen24" FontSize="12" Foreground="{StaticResource LinkTextBrush}" />
                        <TextBlock Text="Open Location" FontSize="10" Foreground="{StaticResource LinkTextBrush}" Margin="4,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- Row 4: Tag pills -->
            <ItemsControl
                Grid.Row="4"
                Margin="0,6,0,0"
                Visibility="{Binding Tags, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource CountToVisibilityConverter}}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate><WrapPanel /></ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemsSource>
                    <Binding Path="Tags" RelativeSource="{RelativeSource AncestorType=UserControl}" />
                </ItemsControl.ItemsSource>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{StaticResource CardBorderBrush}" CornerRadius="8" Padding="6,2" Margin="0,0,4,2" Cursor="Hand" MouseLeftButtonUp="OnTagClick">
                            <TextBlock Text="{Binding}" FontSize="10" Foreground="{StaticResource TextSubtleBrush}" />
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Row 5: License badge -->
            <Border
                Grid.Row="5" Background="{StaticResource CardBorderBrush}" CornerRadius="4" Padding="4,1"
                Margin="0,6,0,0" HorizontalAlignment="Left"
                Visibility="{Binding License, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource NullToVisibilityConverter}}">
                <TextBlock Text="{Binding License, RelativeSource={RelativeSource AncestorType=UserControl}}" FontSize="9" Foreground="{StaticResource TextSubtleBrush}" />
            </Border>

            <!-- Row 6: Action button -->
            <ui:Button
                Grid.Row="6"
                Content="{Binding ActionButtonText, RelativeSource={RelativeSource AncestorType=UserControl}}"
                HorizontalAlignment="Stretch" Padding="8,6" FontSize="11" Margin="0,8,0,0"
                Click="OnActionClick">
                <ui:Button.Style>
                    <Style TargetType="ui:Button" BasedOn="{StaticResource {x:Type ui:Button}}">
                        <Setter Property="Appearance" Value="Secondary" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsActionAdd, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True">
                                <Setter Property="Appearance" Value="Primary" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ui:Button.Style>
            </ui:Button>

            <!-- Row 7: Expanded detail content (binds to DataContext = AppCardModel) -->
            <StackPanel Grid.Row="7" Margin="0,8,0,0"
                Visibility="{Binding IsExpanded, Converter={StaticResource BooleanToVisibilityConverter}}">

                <ui:ProgressRing IsIndeterminate="True" Width="24" Height="24" HorizontalAlignment="Center" Margin="0,8"
                    Visibility="{Binding IsLoadingDetail, Converter={StaticResource BooleanToVisibilityConverter}}" />

                <StackPanel Visibility="{Binding IsLoadingDetail, Converter={StaticResource InverseBooleanToVisibilityConverter}}">

                    <!-- Requires (amber) -->
                    <Border Background="{StaticResource WarningSubtleBrush}" CornerRadius="6" Padding="8" Margin="0,0,0,6"
                        Visibility="{Binding HasRequires, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel>
                            <TextBlock Text="Requires" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource WarningBrush}" Margin="0,0,0,4" />
                            <ItemsControl ItemsSource="{Binding CatalogEntry.Requires}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" FontSize="10" Foreground="{StaticResource WarningBrush}"
                                            TextDecorations="Underline" Cursor="Hand" Margin="0,1"
                                            MouseLeftButtonUp="OnNavigateToAppClick" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- Config Links -->
                    <StackPanel Margin="0,0,0,6" Visibility="{Binding HasFileStatuses, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Config Links" FontSize="11" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,4" />
                        <ItemsControl ItemsSource="{Binding Detail.FileStatuses}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type models:DotfileFileStatus}">
                                    <Grid Margin="0,2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="16" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" FontSize="10" VerticalAlignment="Top" HorizontalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="&#x25CB;" />
                                                    <Setter Property="Foreground" Value="{StaticResource TextMutedBrush}" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Status}" Value="{x:Static models:CardStatus.Synced}">
                                                            <Setter Property="Text" Value="&#x2713;" />
                                                            <Setter Property="Foreground" Value="{StaticResource SuccessBrush}" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="{x:Static models:CardStatus.Drifted}">
                                                            <Setter Property="Text" Value="&#x2717;" />
                                                            <Setter Property="Foreground" Value="{StaticResource ErrorBrush}" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{Binding FileName}" FontSize="10" Foreground="White" />
                                            <TextBlock Text="{Binding FullPath, Converter={StaticResource PathEllipsisConverter}}"
                                                FontSize="9" Foreground="{StaticResource TextDimBrush}" TextTrimming="CharacterEllipsis"
                                                ToolTip="{Binding FullPath}" />
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <!-- Install -->
                    <StackPanel Margin="0,0,0,6" Visibility="{Binding HasInstall, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Install" FontSize="11" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,4" />
                        <StackPanel Visibility="{Binding CatalogEntry.Install.Winget, Converter={StaticResource NullToVisibilityConverter}}">
                            <Grid Margin="0,1"><Grid.ColumnDefinitions><ColumnDefinition Width="60" /><ColumnDefinition Width="*" /></Grid.ColumnDefinitions>
                                <TextBlock Text="winget" FontSize="10" Foreground="{StaticResource TextMutedBrush}" />
                                <TextBox Grid.Column="1" Text="{Binding CatalogEntry.Install.Winget, Mode=OneWay}" IsReadOnly="True" FontSize="10" Foreground="{StaticResource TextLightBrush}" Background="Transparent" BorderThickness="0" Padding="0" />
                            </Grid>
                        </StackPanel>
                        <StackPanel Visibility="{Binding CatalogEntry.Install.Choco, Converter={StaticResource NullToVisibilityConverter}}">
                            <Grid Margin="0,1"><Grid.ColumnDefinitions><ColumnDefinition Width="60" /><ColumnDefinition Width="*" /></Grid.ColumnDefinitions>
                                <TextBlock Text="choco" FontSize="10" Foreground="{StaticResource TextMutedBrush}" />
                                <TextBox Grid.Column="1" Text="{Binding CatalogEntry.Install.Choco, Mode=OneWay}" IsReadOnly="True" FontSize="10" Foreground="{StaticResource TextLightBrush}" Background="Transparent" BorderThickness="0" Padding="0" />
                            </Grid>
                        </StackPanel>
                        <StackPanel Visibility="{Binding CatalogEntry.Install.DotnetTool, Converter={StaticResource NullToVisibilityConverter}}">
                            <Grid Margin="0,1"><Grid.ColumnDefinitions><ColumnDefinition Width="60" /><ColumnDefinition Width="*" /></Grid.ColumnDefinitions>
                                <TextBlock Text="dotnet" FontSize="10" Foreground="{StaticResource TextMutedBrush}" />
                                <TextBox Grid.Column="1" Text="{Binding CatalogEntry.Install.DotnetTool, Mode=OneWay}" IsReadOnly="True" FontSize="10" Foreground="{StaticResource TextLightBrush}" Background="Transparent" BorderThickness="0" Padding="0" />
                            </Grid>
                        </StackPanel>
                        <StackPanel Visibility="{Binding CatalogEntry.Install.NodePackage, Converter={StaticResource NullToVisibilityConverter}}">
                            <Grid Margin="0,1"><Grid.ColumnDefinitions><ColumnDefinition Width="60" /><ColumnDefinition Width="*" /></Grid.ColumnDefinitions>
                                <TextBlock Text="npm" FontSize="10" Foreground="{StaticResource TextMutedBrush}" />
                                <TextBox Grid.Column="1" Text="{Binding CatalogEntry.Install.NodePackage, Mode=OneWay}" IsReadOnly="True" FontSize="10" Foreground="{StaticResource TextLightBrush}" Background="Transparent" BorderThickness="0" Padding="0" />
                            </Grid>
                        </StackPanel>
                    </StackPanel>

                    <!-- Extensions -->
                    <StackPanel Margin="0,0,0,6" Visibility="{Binding HasExtensions, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Extensions" FontSize="11" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,4" />
                        <StackPanel Visibility="{Binding CatalogEntry.Extensions.Bundled, Converter={StaticResource CountToVisibilityConverter}}">
                            <TextBlock Text="Bundled" FontSize="10" Foreground="{StaticResource TextSubtleBrush}" Margin="0,0,0,2" />
                            <ItemsControl ItemsSource="{Binding CatalogEntry.Extensions.Bundled}">
                                <ItemsControl.ItemTemplate><DataTemplate><TextBlock Text="{Binding}" FontSize="9" Foreground="{StaticResource TextMutedBrush}" Margin="8,1,0,0" /></DataTemplate></ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                        <StackPanel Visibility="{Binding CatalogEntry.Extensions.Recommended, Converter={StaticResource CountToVisibilityConverter}}" Margin="0,4,0,0">
                            <TextBlock Text="Recommended" FontSize="10" Foreground="{StaticResource TextSubtleBrush}" Margin="0,0,0,2" />
                            <ItemsControl ItemsSource="{Binding CatalogEntry.Extensions.Recommended}">
                                <ItemsControl.ItemTemplate><DataTemplate><TextBlock Text="{Binding}" FontSize="9" Foreground="{StaticResource TextMutedBrush}" Margin="8,1,0,0" /></DataTemplate></ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </StackPanel>

                    <!-- Tweaks -->
                    <StackPanel Margin="0,0,0,6" Visibility="{Binding HasTweaks, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Tweaks" FontSize="11" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,4" />
                        <ItemsControl ItemsSource="{Binding CatalogEntry.Tweaks}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{StaticResource SurfaceBrush}" CornerRadius="4" Padding="6,4" Margin="0,0,0,4">
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}" FontSize="10" Foreground="White" />
                                            <TextBlock Text="{Binding Description}" FontSize="9" Foreground="{StaticResource TextMutedBrush}" TextWrapping="Wrap"
                                                Visibility="{Binding Description, Converter={StaticResource NullToVisibilityConverter}}" />
                                            <ItemsControl ItemsSource="{Binding Registry}" Margin="0,4,0,0">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock FontSize="8" Foreground="{StaticResource TextDimBrush}" TextWrapping="Wrap">
                                                            <Run Text="{Binding Name, Mode=OneWay}" /><Run Text=" = " /><Run Text="{Binding Value, Mode=OneWay}" />
                                                        </TextBlock>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <!-- Alternatives -->
                    <StackPanel Margin="0,0,0,4" Orientation="Horizontal"
                        Visibility="{Binding HasAlternatives, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Alternatives: " FontSize="10" Foreground="{StaticResource TextSubtleBrush}" VerticalAlignment="Center" />
                        <ItemsControl ItemsSource="{Binding CatalogEntry.Alternatives}">
                            <ItemsControl.ItemsPanel><ItemsPanelTemplate><WrapPanel /></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" FontSize="10" Foreground="{StaticResource InfoBrush}" TextDecorations="Underline" Cursor="Hand" Margin="0,0,6,0"
                                        MouseLeftButtonUp="OnNavigateToAppClick" />
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <!-- Also Consider -->
                    <StackPanel Margin="0,0,0,4" Orientation="Horizontal"
                        Visibility="{Binding HasSuggests, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Also consider: " FontSize="10" Foreground="{StaticResource TextSubtleBrush}" VerticalAlignment="Center" />
                        <ItemsControl ItemsSource="{Binding CatalogEntry.Suggests}">
                            <ItemsControl.ItemsPanel><ItemsPanelTemplate><WrapPanel /></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" FontSize="10" Foreground="{StaticResource InfoBrush}" TextDecorations="Underline" Cursor="Hand" Margin="0,0,6,0"
                                        MouseLeftButtonUp="OnNavigateToAppClick" />
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <!-- Footer: License + OS pills -->
                    <Border Background="{StaticResource SurfaceBrush}" CornerRadius="4" Padding="6,4" Margin="0,4,0,0">
                        <StackPanel Orientation="Horizontal">
                            <Border Background="{StaticResource CardBorderBrush}" CornerRadius="4" Padding="4,1" Margin="0,0,6,0"
                                Visibility="{Binding License, Converter={StaticResource NullToVisibilityConverter}}">
                                <TextBlock Text="{Binding License}" FontSize="9" Foreground="{StaticResource TextSubtleBrush}" />
                            </Border>
                            <ItemsControl ItemsSource="{Binding CatalogEntry.Os}" Visibility="{Binding HasOs, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <ItemsControl.ItemsPanel><ItemsPanelTemplate><StackPanel Orientation="Horizontal" /></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource AccentSubtleBrush}" CornerRadius="4" Padding="4,1" Margin="0,0,4,0">
                                            <TextBlock Text="{Binding}" FontSize="9" Foreground="{StaticResource AccentBrush}" />
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- Related Apps -->
                    <StackPanel Margin="0,6,0,0" Visibility="{Binding HasDependents, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock FontSize="11" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,4">
                            <Run Text="Related Apps (" /><Run Text="{Binding DependentAppCount, Mode=OneWay}" /><Run Text=")" />
                        </TextBlock>
                        <ItemsControl ItemsSource="{Binding DependentApps}">
                            <ItemsControl.ItemsPanel><ItemsPanelTemplate><WrapPanel /></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="{x:Type models:AppCardModel}">
                                    <Border Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource CardBorderBrush}" BorderThickness="1" CornerRadius="6" Padding="8,6" Margin="0,0,6,6" Width="160">
                                        <Grid>
                                            <Grid.RowDefinitions><RowDefinition Height="Auto" /><RowDefinition Height="Auto" /></Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions><ColumnDefinition Width="Auto" /><ColumnDefinition Width="*" /></Grid.ColumnDefinitions>
                                            <controls:StatusRibbon Grid.Column="0" Status="{Binding Status}" VerticalAlignment="Center" Margin="0,0,4,0" />
                                            <TextBlock Grid.Column="1" Text="{Binding DisplayLabel}" FontSize="10" FontWeight="SemiBold" Foreground="White" TextTrimming="CharacterEllipsis" />
                                            <TextBlock Grid.Row="1" Grid.ColumnSpan="2" FontSize="9" Foreground="{StaticResource TextMutedBrush}" Margin="0,2,0,0" TextTrimming="CharacterEllipsis">
                                                <TextBlock.Text><Binding Path="Tags[0]" FallbackValue="" /></TextBlock.Text>
                                            </TextBlock>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
