<Page
    x:Class="Perch.Desktop.Views.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:Perch.Desktop.ViewModels"
    d:DataContext="{d:DesignInstance vm:SettingsViewModel}"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Foreground="White"
    Loaded="OnLoaded">

    <ScrollViewer Margin="24,16" VerticalScrollBarVisibility="Auto">
        <StackPanel MaxWidth="600">
            <ui:TextBlock FontTypography="Title" Text="Settings" Margin="0,0,0,24" />

            <!-- Config Repo Path -->
            <ui:TextBlock FontTypography="Subtitle" Text="Config Repository" Margin="0,0,0,8" />
            <ui:TextBlock
                FontTypography="Caption"
                Opacity="0.6"
                Text="Path to your perch-config repository containing module manifests."
                Margin="0,0,0,8" />
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <ui:TextBox
                    Grid.Column="0"
                    PlaceholderText="e.g. C:\Users\you\perch-config"
                    Text="{Binding ConfigRepoPath, UpdateSourceTrigger=PropertyChanged}" />
                <ui:Button
                    Grid.Column="1"
                    Content="Browse"
                    Margin="8,0,0,0"
                    Command="{Binding BrowseConfigRepoCommand}" />
            </Grid>

            <!-- Save -->
            <StackPanel Orientation="Horizontal" Margin="0,16,0,0">
                <ui:Button
                    Appearance="Primary"
                    Content="Save"
                    Command="{Binding SaveCommand}"
                    IsEnabled="{Binding IsSaving, Converter={StaticResource InverseBooleanConverter}}" />
                <ui:TextBlock
                    FontTypography="Caption"
                    Opacity="0.6"
                    Text="{Binding StatusMessage}"
                    VerticalAlignment="Center"
                    Margin="12,0,0,0" />
            </StackPanel>

            <!-- Reload Configuration -->
            <ui:TextBlock FontTypography="Subtitle" Text="Reload Configuration" Margin="0,32,0,8" />
            <ui:TextBlock
                FontTypography="Caption"
                Opacity="0.6"
                Text="Re-scan all manifests and refresh the dashboard status."
                Margin="0,0,0,8" />
            <ui:Button
                Content="Reload Configuration"
                Icon="{ui:SymbolIcon ArrowClockwise24}"
                Command="{Binding ReloadConfigurationCommand}" />

            <!-- Developer -->
            <ui:TextBlock FontTypography="Subtitle" Text="Developer" Margin="0,32,0,8" />
            <CheckBox Content="Enable developer mode" IsChecked="{Binding IsDev}" />

            <!-- Current Work -->
            <StackPanel Visibility="{Binding ShowCurrentWork, Converter={StaticResource BooleanToVisibilityConverter}}">
                <ui:TextBlock FontTypography="Subtitle" Text="Current Work" Margin="0,12,0,8" />
                <Border Padding="16,12" CornerRadius="6" Background="#1A2E1A">
                    <StackPanel>
                        <ui:TextBlock FontTypography="BodyStrong" Text="{Binding CurrentWorkIssue}" />
                        <ui:TextBlock FontTypography="Caption" Opacity="0.6" Text="{Binding CurrentWorkBranch}" Margin="0,4,0,0" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- About -->
            <ui:TextBlock FontTypography="Subtitle" Text="About" Margin="0,32,0,8" />
            <Border
                Padding="16,12"
                CornerRadius="6"
                Background="#1A1A2E">
                <StackPanel>
                    <Grid Margin="0,0,0,8">
                        <ui:TextBlock FontTypography="BodyStrong" Text="Perch Desktop" />
                        <ui:TextBlock
                            FontTypography="Caption"
                            Opacity="0.6"
                            HorizontalAlignment="Right"
                            Text="{Binding AppVersion, StringFormat='v{0}'}" />
                    </Grid>
                    <ui:TextBlock
                        FontTypography="Caption"
                        Opacity="0.6"
                        Text="Cross-platform dotfiles and application settings manager."
                        TextWrapping="Wrap" />
                    <ui:TextBlock
                        FontTypography="Caption"
                        Opacity="0.6"
                        Margin="0,4,0,0"
                        Text="Symlink-first: change a setting, it's immediately in git." />
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>

</Page>
